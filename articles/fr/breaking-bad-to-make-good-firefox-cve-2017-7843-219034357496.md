---
title: J'ai découvert une faille majeure dans le mode de navigation privée de Mozilla.
subtitle: ''
author: freeCodeCamp
co_authors: []
series: null
date: '2018-04-22T15:45:16.000Z'
originalURL: https://freecodecamp.org/news/breaking-bad-to-make-good-firefox-cve-2017-7843-219034357496
coverImage: https://cdn-media-1.freecodecamp.org/images/1*_wACV-5_7XXEx3uUSW4sUw.png
tags:
- name: bug bounty
  slug: bug-bounty
- name: '#infosec'
  slug: infosec
- name: General Programming
  slug: programming
- name: Security
  slug: security
- name: 'tech '
  slug: tech
seo_title: J'ai découvert une faille majeure dans le mode de navigation privée de
  Mozilla.
seo_desc: 'By Konark Modi

  If left unfixed this flaw could have wreaked havoc but Mozilla’s prompt fixes saved
  the day.

  In this article, I’ll discuss details of a bug I discovered with Mozilla Firefox
  private browsing mode that made it possible for private brows...'
---

Par Konark Modi

Si elle n'avait pas été corrigée, cette faille aurait pu causer des ravages, mais les correctifs rapides de Mozilla ont sauvé la situation.

Dans cet article, je vais discuter des détails d'un bug que j'ai découvert avec le mode de navigation privée de Mozilla Firefox, qui permettait de suivre les sessions de navigation privée.

![Image](https://cdn-media-1.freecodecamp.org/images/nQCoNGC0tbc9SPMGqEXmPNDFQAzj7iX6D9VC)

La [navigation privée](https://support.mozilla.org/en-US/kb/private-browsing-use-firefox-without-history) est l'une des fonctionnalités les plus connues et utilisées dans les navigateurs modernes aujourd'hui. Les navigateurs ajoutent continuellement de [nombreuses](https://blog.mozilla.org/security/2018/01/31/preventing-data-leaks-by-stripping-path-information-in-http-referrers/) améliorations à la navigation privée pour renforcer la confidentialité des utilisateurs.

Les fonctionnalités offertes peuvent différer d'un navigateur à l'autre, mais au minimum, un utilisateur utilisant la navigation privée a les deux exigences les plus basiques :

1. Les sites web visités en mode privé ne peuvent pas sauvegarder de données

2. Les pages visitées ne sont pas sauvegardées

Eh bien, j'ai découvert que le mode de navigation privée du navigateur Firefox ne répondait à aucune de ces exigences.

### **Détails techniques**

Pour qu'un site web puisse suivre un utilisateur à travers les sessions de navigation privée, il doit utiliser un stockage persistant au niveau du navigateur.

Il existe plusieurs façons de stocker des données dans un navigateur - [LocalStorage](https://developer.mozilla.org/en-US/docs/Web/API/Storage/LocalStorage), [WebSQL](http://www.w3.org/TR/webdatabase/) et [IndexedDB](https://developer.mozilla.org/en-US/docs/Web/API/IndexedDB_API).

Je suis récemment tombé sur le stockage IndexedDB.

> IndexedDB est une API de bas niveau pour **le stockage côté client de quantités importantes de données structurées, y compris des fichiers/blobs** - Mozilla Developer Network

Bien que, selon la documentation, IndexedDB ne devrait pas être disponible en mode de navigation privée.

![Image](https://cdn-media-1.freecodecamp.org/images/mGRjKaicfoCy9k30nF02RurfMy1nh1sM4WDS)

Si vous utilisez IndexedDB directement sur la page web, cela générera une erreur :

![Image](https://cdn-media-1.freecodecamp.org/images/jGh-PWy46yvl9wWMU8DelSbEAxNy-rAA2C2b)

Mais que se passe-t-il si vous combinez IndexedDB avec des [Web Workers](https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API) ?

> Les Web Workers permettent d'**exécuter une opération de script en arrière-plan dans un thread séparé du thread d'exécution principal** d'une application web - Mozilla Developer Network

### **Détails du problème : Les conséquences**

IndexedDB peut être accessible en mode de navigation privée via les Web Workers. Non seulement cela, mais lorsque le navigateur est fermé, les données IndexedDB ne sont pas effacées. Ces données **persisteront à travers plusieurs sessions de navigation privée** car elles ne sont pas effacées à la sortie.

Alors, examinons quelques façons dont ce problème pourrait être exploité.

#### **Sites web**

Un site web malveillant peut exploiter IndexedDB et suivre les utilisateurs à travers les sessions de navigation privée. Par exemple, supposons que vous avez visité **badsite.com**, qui utilise des Web Workers et IndexedDB en mode de navigation privée. Fermez la fenêtre de navigation privée, fermez Firefox, redémarrez Firefox, lancez le mode de navigation privée et visitez à nouveau badsite.com. Le site web pourra accéder aux données de votre précédente session de navigation privée, car les données sont toujours stockées dans IndexedDB.

#### **Tiers**

Supposons que **siteA.com** charge un script d'analyse depuis **BadAnalyticsSite.com**. Ensuite, un autre site web, **siteB.com**, charge également un script d'analyse depuis le même site **BadAnalyticsSite.com**. Puisque le site malveillant **BadAnalyticsSite.com** utilise des Web Workers et IndexedDB, le site **BadAnalyticsSite.com** peut maintenant suivre les utilisateurs des sites **siteA.com** et **siteB.com** à travers toutes leurs sessions de navigation privée.

#### **Fuites de disque**

[IndexedDB adhère à une politique de même origine](https://developer.mozilla.org/en-US/docs/Web/API/IndexedDB_API/Basic_Concepts_Behind_IndexedDB), ce qui signifie que chaque base de données a un nom qui l'identifie au sein d'une origine. Comme le nom de domaine est utilisé comme partie du nom de fichier, cela peut entraîner de sérieux problèmes lorsqu'il est utilisé en mode privé.

Par exemple, si un utilisateur visite une [page web de test](https://cdn.cliqz.com/browser-f/fun-demo/test-webworker-indexed-db.html) (démo) qui utilise des Web Workers + IndexedDB hébergés sur `cdn.cliqz.com`, et charge une ressource depuis `konarkmodi.github.io`, les deux entrées suivantes sont créées sur le disque.

![Image](https://cdn-media-1.freecodecamp.org/images/7Lvp2fMquDHAQMbhxaLe9U3O-nfHbtzBQaUf)
_Emplacement de IndexedDB : `profile/storage` liste les pages web Poc._

En raison de la faille ci-dessus, un site web ou un tracker pourrait effectivement générer une empreinte digitale et la sauvegarder. Même si un utilisateur devait effacer l'historique du site web ou sélectionner l'option « oublier ce site », le stockage IndexDB n'est pas supprimé. Cela peut créer un stockage permanent pour un site web ou un tracker qui peut être exploité pour toujours.

### **Rapport et correctifs**

Mozilla encourage la recherche en sécurité pour ses produits. En leurs propres termes :

> Le programme de prime aux bugs de sécurité client de Mozilla est conçu pour encourager la recherche en sécurité dans les logiciels Mozilla et pour récompenser ceux qui nous aident à créer les logiciels Internet les plus sûrs qui existent.

J'ai signalé ce problème en octobre 2017 via leur [Programme de prime aux bugs](https://www.mozilla.org/en-US/security/client-bug-bounty/), et le problème a été corrigé en novembre 2017. Ils ont été prompts à identifier et à corriger les problèmes.

![Image](https://cdn-media-1.freecodecamp.org/images/OC0xoCmQYVA47kPOOHbrlrDdoOm1omUa2MOv)

Pour plus de détails, vous pouvez lire le rapport de bug complet sur [Bugzilla de Mozilla](https://bugzilla.mozilla.org/show_bug.cgi?id=1410106).

J'apprécie vraiment les efforts et les actions de Mozilla pour corriger les problèmes avec la plus haute priorité lorsqu'il s'agit de la confidentialité de ses utilisateurs.

Bon piratage !

Vous pouvez me suivre sur Twitter à l'adresse [Konark Modi](https://twitter.com/konarkmodi)

Merci d'avoir lu et partagé ! :)

Si vous avez aimé cette histoire, n'hésitez pas à ??? plusieurs fois (jusqu'à 50 fois. Sérieusement).

_Crédits : Un grand merci à [Remi](https://twitter.com/Pythux) et [Pallavi](https://twitter.com/Pi_Modi) pour avoir relu cet article :)_