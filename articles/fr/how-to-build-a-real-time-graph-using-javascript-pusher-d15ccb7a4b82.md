---
title: Comment créer un graphique en temps réel avec JavaScript et Pusher
subtitle: ''
author: freeCodeCamp
co_authors: []
series: null
date: '2018-02-11T18:23:23.000Z'
originalURL: https://freecodecamp.org/news/how-to-build-a-real-time-graph-using-javascript-pusher-d15ccb7a4b82
coverImage: https://cdn-media-1.freecodecamp.org/images/1*OV9Z2nnWNUHlfeTqyZsotg.jpeg
tags:
- name: JavaScript
  slug: javascript
- name: Node.js
  slug: nodejs
- name: General Programming
  slug: programming
- name: technology
  slug: technology
- name: Web Development
  slug: web-development
seo_title: Comment créer un graphique en temps réel avec JavaScript et Pusher
seo_desc: 'By Rahat Khanna

  The world needs everything uber-fast now. There are plenty of data streams being
  generated by different systems every day. They serve in making decisions in many
  industries. Realtime monitoring and analysis have become very important ...'
---

Par Rahat Khanna

Le monde a besoin de tout, ultra-rapide maintenant. Il existe de nombreux flux de données générés par différents systèmes chaque jour. Ils servent à prendre des décisions dans de nombreuses industries. La surveillance et l'analyse en temps réel sont devenues très importantes aujourd'hui. Les flux de données incluent la surveillance en temps réel du trafic du site web, des performances du serveur, des mises à jour météorologiques et des capteurs IOT. Il est important d'analyser et d'interpréter cette explosion de données, pour laquelle les graphiques et les tableaux interactifs sont une excellente solution.

Dans cet article, nous allons construire un serveur Node.js pour exposer des API afin de fournir des données historiques pour une métrique (dans ce cas, la météo à Londres). Il fournira également une API pour ingérer de nouveaux points de données. Nous allons également construire une application front-end avec un graphique en ligne pour afficher les changements de température de la météo à Londres en temps réel. L'application que nous construirons ressemblera à quelque chose comme ceci :

![Image](https://cdn-media-1.freecodecamp.org/images/0*FRqdiqdKGjkXyZJV.gif)

### Inscription à Pusher

La première étape pour commencer ce tutoriel est de [s'inscrire à Pusher](https://pusher.com/signup) ou de se connecter avec vos identifiants existants si vous avez déjà un compte. Après vous être connecté, vous devrez créer une nouvelle application et sélectionner Vanilla JavaScript pour le front-end ainsi que Node.js pour le back-end. Vous serez alors redirigé vers une page d'accueil contenant le code de "démarrage" pour le front-end et le back-end, que nous utiliserons plus tard dans le tutoriel.

### API du serveur Node.js pour le système de surveillance et d'analyse

Les API essentielles pour tout système d'analyse pour toute métrique ou entité sont :

1. API d'ingestion — Une API pour ingérer les nouveaux points de données pour toute entité particulière. Dans notre serveur pour cet article de blog, nous créerons une API pour ingérer de nouvelles données de température à un moment particulier pour Londres. Cette API peut être appelée par tout système météorologique global ou tout capteur IOT.
2. API de données historiques — Cette API retournera toutes les données dans une plage à partir de cette date dans le temps. Pour notre serveur, nous créerons une API simple. Elle retournera certaines données historiques statiques avec des points de données limités pour les valeurs de température de Londres pour un jour donné.

### Squelette du serveur Node.js Express

Nous allons créer un serveur Express de base ainsi qu'une instance de serveur de bibliothèque Pusher. Nous allons créer un nouveau dossier pour notre projet et créer un nouveau fichier **server.js**. Ajoutez le code suivant à ce fichier :

#### **API pour obtenir les données historiques de température**

Maintenant, nous allons ajouter quelques données statiques concernant la température de Londres à certains moments de la journée et les stocker dans une variable JavaScript. Nous allons également exposer une route pour retourner ces données chaque fois que quelqu'un l'invoque en utilisant un appel HTTP GET.

#### **API pour ingérer un point de données de température**

Maintenant, nous allons ajouter le code pour exposer une API afin d'ingérer la température à un moment particulier. Nous allons exposer une API HTTP GET avec la température et le temps comme paramètres de requête. Nous validerons qu'ils ne sont pas des paramètres vides. Nous les stockons en les poussant dans le tableau **dataPoints** de notre variable JavaScript statique **londonTempData**. Veuillez ajouter le code suivant au fichier **server.js**

Dans le code ci-dessus, en plus de stocker dans la source de données, nous allons également déclencher un événement **'new-temperature'** sur un nouveau canal **'london-temp-chart'**. Pour chaque source de données unique ou un graphique, vous pouvez créer un nouveau canal.

L'événement déclenché par notre serveur sera traité par le front-end pour mettre à jour le graphique/graph en temps réel. L'événement peut contenir toutes les données importantes dont le graphique a besoin pour afficher correctement le point de données. Dans notre cas, nous allons envoyer la température à la nouvelle heure à notre front-end.

### Construction de l'application front-end avec Vanilla JavaScript et Chart.js

Maintenant, nous allons construire l'application front-end. Elle affichera un graphique en ligne représentant les changements de température pour la ville de Londres à différents moments de la journée. L'approche clé pour afficher des graphiques en temps réel est :

1. Nous devons faire un appel Ajax initial pour récupérer les données historiques et rendre le graphique avec les données existantes.
2. Nous allons nous abonner à tout événement pour les nouveaux points de données stockés sur un canal particulier.

### Modèle HTML de base

Nous allons créer un nouveau dossier appelé **public** à la racine de notre projet, puis créer un nouveau fichier **index.html** dans ce dossier. Ce fichier contiendra le code HTML de base pour rendre un en-tête simple et un sous-en-tête avec le nom de l'application ainsi que quelques icônes. Nous allons également importer la bibliothèque **Pusher JavaScript** depuis son URL CDN.

### Ajout de la bibliothèque de graphiques

Dans les applications JavaScript et HTML, nous devons utiliser soit SVG soit Canvas pour construire des composants graphiques afin de représenter des graphiques mathématiques. Il existe de nombreuses bibliothèques open source qui peuvent vous aider à rendre différents types de graphiques. Ceux-ci incluent les graphiques en barres, les graphiques circulaires, les graphiques en ligne et les graphiques de dispersion.

Pour notre projet, nous choisirons [Chart.js](http://www.chartjs.org/) car il a une API assez simple et rend des graphiques robustes en utilisant une balise Canvas HTML. Vous pouvez choisir n'importe quelle bibliothèque de graphiques, mais gardez à l'esprit que la bibliothèque doit avoir un moyen de mettre à jour le graphique sans le rendre complètement. Chart.js fournit une méthode sur tout graphique instancié pour le mettre à jour.

Ajoutez le code suivant à votre fichier index.html aux endroits appropriés

### Ajout du fichier JavaScript et instanciation de la bibliothèque Pusher côté client

Maintenant, nous allons créer un nouveau fichier **app.js** dans notre dossier public et ajouter également le code suivant pour instancier la bibliothèque Pusher côté client.

Dans le code ci-dessus, nous avons également ajouté quelques méthodes utilitaires pour faire un appel Ajax et également afficher ou masquer des éléments à partir de l'API DOM.

### Ajout de code pour récupérer les données historiques

Maintenant, nous allons ajouter le code pour récupérer les données historiques de température afin d'afficher le graphique avec les valeurs initiales. Nous allons également instancier un nouvel objet Chart avec une configuration spécifique pour rendre un graphique en ligne. Vous pouvez en savoir plus sur la façon de construire ces configurations dans la [documentation de Chart.js](http://www.chartjs.org/docs/).

Veuillez ajouter le code suivant au fichier app.js :

Dans le code ci-dessus, nous avons ajouté une fonction nommée **renderWeatherChart**. Celle-ci sera utilisée pour rendre le graphique en utilisant les dernières données qui sont intégrées dans la variable **chartConfig** sous la clé **datasets**. Si nous voulons tracer plusieurs graphiques en ligne sur la même toile, nous pouvons ajouter plus d'éléments à ce tableau.

La clé **data** dans chacun des éléments du tableau affichera les différents points sur le graphique. Nous ferons une requête ajax à l'API **/getTemperature** pour récupérer tous les points de données et les mettre dans cette clé. Nous appellerons la méthode de rendu pour afficher le graphique ensuite. Maintenant, nous pouvons exécuter la commande `node server.js` puis aller dans le navigateur avec l'URL suivante pour voir le graphique initial rendu en utilisant les données.

```
http://localhost:9000/
```

Afin de styliser correctement notre application, veuillez ajouter le CSS suivant dans un nouveau fichier style.css à l'intérieur du dossier public. Ajoutez le code suivant à ce fichier :

### Code pour mettre à jour le graphique lors de la réception d'un nouvel événement

Maintenant, nous voulons nous abonner au canal unique sur lequel notre serveur enverra des événements de mise à jour pour ce graphique. Pour notre projet, le canal s'appelle **london-temp-chart** et l'événement s'appelle **new-temperature**. Veuillez ajouter le code suivant pour traiter l'événement puis mettre à jour le graphique en temps réel :

Afin de voir ce code en action, vous devez actualiser le navigateur et vous verrez le graphique initial. Maintenant, nous devons ingérer un nouveau point de données. Vous devrez appeler l'API suivante soit en utilisant un outil d'appel d'API mock, soit en utilisant l'URL suivante avec différentes valeurs dans le navigateur.

```
http://localhost:9000/addTemperature?temperature=17&time=1500
```

Afin de tester votre code de mise à jour de graphique, vous pouvez utiliser le code temporaire suivant dans votre fichier **app.js**. Il fera des requêtes Ajax factices à l'URL ci-dessus après un intervalle de temps spécifique.

Voici le [dépôt GitHub](https://github.com/mappmechanic/realtime-analytics) pour référence au code complet.

### Conclusion

Enfin, notre application d'analyse en temps réel est prête. Nous verrons le graphique de température météorologique pour la ville de Londres se mettre à jour en temps réel.

![Image](https://cdn-media-1.freecodecamp.org/images/0*kZFwZkxqSkpUT3-K.gif)

Nous pouvons utiliser le code de cet article de blog pour toute bibliothèque de graphiques. Il peut également rendre tout type de graphique comme un graphique en barres, un graphique de dispersion ou un graphique circulaire pour se mettre à jour en temps réel.

Ce code peut également être utilisé dans plusieurs applications d'entreprise. Par exemple, des tableaux de bord de surveillance, des rapports d'analyse, des applications de régulation de capteurs et des applications financières. La bibliothèque Pusher nous aide à envoyer des événements en temps réel à toutes les applications côté client connectées. Ces applications peuvent consommer les données pour mettre à jour les graphiques en temps réel.

Cet article a été initialement publié sur le [blog de Pusher](https://blog.pusher.com/build-realtime-graph-using-javascript/).