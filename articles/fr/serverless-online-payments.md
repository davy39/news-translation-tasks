---
title: Comment configurer des paiements en ligne sans serveur avec Netlify et Stripe
subtitle: ''
author: freeCodeCamp
co_authors: []
series: null
date: '2021-11-17T20:54:10.000Z'
originalURL: https://freecodecamp.org/news/serverless-online-payments
coverImage: https://www.freecodecamp.org/news/content/images/2021/11/
seo_title: Comment configurer des paiements en ligne sans serveur avec Netlify et
  Stripe
---

-1--2.png
tags:
- name: Netlify
  slug: netlify
- name: paiements
  slug: paiements
- name: serverless
  slug: serverless
- name: 'Applications √† Page Unique'
  slug: single-page-applications
seo_title: null
seo_desc: "Par Alain Perkaz\nL'une des premi√®res √©tapes que de nombreuses jeunes startups franchissent est la mise en place d'une page web statique, peut-√™tre avec une newsletter par email, pour les aider √† construire un public. \nAu fil des semaines et alors que le MVP avance, la question de la gestion des paiements finira par √©merger.\nDe la gestion des paiements ponctuels aux abonnements SaaS, la prise en charge des paiements en ligne peut sembler intimidante et chronophage. Cet article vous pr√©sentera une m√©thode simple pour traiter les paiements en ligne avec Stripe, sans infrastructure suppl√©mentaire autre qu'une page web statique.\nVous n'avez pas besoin d'un backend personnalis√© pour stocker les informations de paiement, ni de t√¢ches cron pour envoyer des factures, et il n'est pas n√©cessaire de suivre les clients dans une base de donn√©es s√©par√©e. C'est parfait si vous √™tes un fondateur unique ou une startup en phase de d√©marrage qui souhaite valider l'id√©e sans cr√©er une solution personnalis√©e.\nCela semble bien ? Plongeons-nous dans le sujet ! üí°\n\n## Aper√ßu g√©n√©ral du projet\n\nPour les besoins de cet article, nous allons d√©finir un cas d'utilisation pour une startup en phase de d√©marrage, o√π ce type de configuration de paiement en ligne sans serveur apportera le plus de valeur (co√ªt faible et rapide √† mettre en ≈ìuvre).\n\nImaginons que notre id√©e de startup est d'auto-publier un livre. Alors que le livre est en cours de finalisation, nous aimerions ouvrir l'acc√®s √† vie au livre en pr√©-vente.\n\nNous aurons besoin d'un moyen de traiter les paiements pour l'acc√®s √† vie au livre. Pour cela, nous aurons besoin d'un processeur de paiement et peut-√™tre d'un moyen d'ex√©cuter une logique c√¥t√© serveur (par exemple, en utilisant l'API du processeur de paiement).\n\n### Processeur de paiement\n\nIl existe de nombreux processeurs de paiement disponibles, chacun avec des conditions diff√©rentes, une prise en charge des m√©thodes de paiement et des API publiques. Pour notre processeur de paiement en ligne sans serveur, nous utiliserons [Stripe](https://stripe.com/). J'ai choisi d'utiliser Stripe pour deux raisons :\n\nPremi√®rement, Stripe est un processeur de paiement leader dans l'industrie avec une excellente API. Leur API est extensivement document√©e, et ils offrent des SDK d'int√©gration pour de nombreux langages (y compris JS). La configuration est enti√®rement gratuite, et vous ne payez qu'une petite commission par transaction trait√©e.\n\nDeuxi√®mement, Stripe propose Stripe Checkout, un produit gratuit sp√©cifiquement con√ßu pour augmenter les conversions et prendre en charge diverses options de paiement. Il est extr√™mement simple √† int√©grer et offre une excellente interface utilisateur.\n\n### Et le serveur ?\n\nPour √™tre clair, Stripe n√©cessite un certain code c√¥t√© serveur pour g√©n√©rer une session une fois qu'un utilisateur a saisi ses donn√©es de paiement. La session est disponible pour le d√©veloppeur afin d'effectuer des op√©rations li√©es au paiement (sans exposer les d√©tails de paiement sensibles).\n\nAvant de vous f√¢cher contre moi, laissez-moi clarifier que nous n'aurons pas besoin de configurer un serveur d√©di√© üòÖ. Cela peut sembler un peu contradictoire, mais Stripe n√©cessite que certains du code d'interaction soit dans un environnement de type serveur (le calcul sans serveur √† la rescousse !).\n\nHeureusement pour nous, nous sommes en 2021, et il existe plusieurs options pour ex√©cuter du code c√¥t√© serveur √† la demande. La plupart des fournisseurs de cloud offrent cette fonctionnalit√© (AWS lambdas, Google Cloud cloud functions, Azure functions... vous voyez le tableau).\n\nPuisque notre startup a d√©j√† une page web, nous utiliserons [Netlify functions](https://www.netlify.com/products/functions/). Cela nous permettra d'ex√©cuter le code c√¥t√© serveur avec presque aucune configuration suppl√©mentaire, et il s'int√®gre parfaitement avec les ressources statiques de la page web existante.\n\nLe paradigme de la combinaison des ressources web statiques avec des fonctions sans serveur √† la demande fait partie de la [JAM Stack](https://jamstack.org/) (nous laisserons cela pour un autre article). Continuez √† lire pour les instructions d√©taill√©es sur la configuration des paiements sans serveur.\n\n![Image](https://paper-attachments.dropbox.com/s_16ACAF73564EBCEEB7494C6A4225B10D5BBA9580C5BBD5452113AF0E1E7CCE6B_1635610448861_image.png)\n_Sch√©ma de haut niveau de la solution_\n\n# Configuration du projet √©tape par √©tape\n\nSuper, maintenant que vous avez une image claire de l'espace probl√®me et des outils que nous allons utiliser pour construire notre solution, construisons-la. üöÄ\n\nL'exemple de code complet est disponible √† l'adresse [https://github.com/aperkaz/serverless-payments](https://github.com/aperkaz/serverless-payments).\n\n### Comment configurer Netlify\n\nTout d'abord, cr√©ez un compte [Netlify](https://www.netlify.com/) (si vous n'en avez pas d√©j√† un). Le niveau gratuit est suffisant pour une utilisation mod√©r√©e, donc pas besoin de s'inqui√©ter √† ce sujet.\n\nNetlify fournit CI/CD pour des d√©ploiements automatis√©s de notre page web et des fonctions sans serveur en se connectant √† un d√©p√¥t Git dans Github / Gitlab / Bitbucket. Donc, cr√©ons un d√©p√¥t dans l'un de ces fournisseurs avec les ressources de votre site web.\n\nEnsuite, installez le [Netlify CLI](https://cli.netlify.com/getting-started/). Il vous posera quelques questions et demandera l'acc√®s √† votre compte Netlify et √† votre fournisseur de d√©p√¥t Git (GitHub dans mon cas).\n\n![Image](https://paper-attachments.dropbox.com/s_16ACAF73564EBCEEB7494C6A4225B10D5BBA9580C5BBD5452113AF0E1E7CCE6B_1635614098858_Screenshot+2021-10-30+at+19.14.47.png)\n_Installation du CLI avec `npm install netlify-cli -g`_\n\n√Ä ce stade, nous pouvons pousser vers la branche `main` / `master` du d√©p√¥t, et Netlify d√©ployera automatiquement. Vous pouvez ex√©cuter `netlify open` dans la console pour ouvrir le panneau d'administration de Netlify, et visiter l'URL d√©ploy√©e.\n\n![Image](https://paper-attachments.dropbox.com/s_16ACAF73564EBCEEB7494C6A4225B10D5BBA9580C5BBD5452113AF0E1E7CCE6B_1635614710558_Screenshot+2021-10-30+at+19.19.40.png)\n\n\nExcellent, avec le d√©ploiement automatique pr√™t, configurons maintenant Stripe. üí∞\n\n### Comment configurer Stripe\n\nCr√©ez un compte dans Stripe, validez l'email, et connectez-vous. Ensuite, [g√©n√©rez un ensemble de cl√©s API](https://stripe.com/docs/keys) (cl√© secr√®te et cl√© publiable).\n\nVous devez √™tre prudent avec ces cl√©s et ne jamais commettre la cl√© secr√®te dans le code. Puisque nous en aurons besoin dans notre code c√¥t√© serveur, nous la garderons comme une [variable d'environnement](https://www.netlify.com/blog/2021/07/12/managing-environment-variables-from-your-terminal-with-netlify-cli/).\n\n```bash\n# Cr√©er une nouvelle variable d'environnement dans Netlify\nnetlify env:set STRIPE_SECRET "sk_****"\n\n# Nous pouvons y acc√©der dans notre code JS c√¥t√© serveur par :\nprocess.env.STRIPE_SECRET\n```\n\nPour les besoins de ce tutoriel, nous utiliserons les [cl√©s API d'exemple](https://stripe.com/docs/payments/accept-a-payment?integration=checkout#set-up-stripe), mais n'h√©sitez pas √† utiliser les v√¥tres. Si vous utilisez vos propres cl√©s, vous devrez ajouter des produits et des prix ([documentation](https://support.stripe.com/questions/how-to-create-products-and-prices)).\n\n### Comment ajouter les fonctions sans serveur\n\nAccrochez-vous bien ‚Äì nous y sommes presque ! Nous avons seulement besoin du code c√¥t√© serveur pour cr√©er des sessions Stripe Checkout et compl√©ter notre d√©monstration.\n\nTout d'abord, pour rendre notre fonction accessible depuis [https://serverless-payments.netlify.app/api/stripe](https://serverless-payments.netlify.app/api/stripe), nous devons ajouter quelques configurations. Commen√ßons par cr√©er le fichier `netlify.toml`, √† la racine de notre d√©p√¥t.\n\n```toml\n[build]\n  command = "# no build command"\n  functions = "netlify/functions"\n  publish = "."\n\n[[redirects]]\n  from = '/api/*'\n  to = '/.netlify/functions/:splat'\n  status = 200\n```\n\nEnsuite, nous pouvons ajouter la fonction de cr√©ation de session. Elle est expliqu√©e [ici](https://stripe.com/docs/payments/accept-a-payment?integration=checkout#set-up-stripe).\n\n```javascript\n// netlify/function/stripe.js\n\nconst stripe = require("stripe")(process.env.STRIPE_SECRET);\n\nexports.handler = async (event, context) => {\n  const session = await stripe.checkout.sessions.create({\n    payment_method_types: ["card"],\n    line_items: [\n      {\n        price_data: {\n          currency: "usd",\n          product_data: {\n            name: "T-shirt",\n          },\n          unit_amount: 2000,\n        },\n        quantity: 1,\n      },\n    ],\n    mode: "payment",\n    success_url: "https://serverless-payments.netlify.app/success",\n    cancel_url: "https://serverless-payments.netlify.app/cancel",\n  });\n  return {\n    statusCode: 200,\n    body: JSON.stringify({\n      id: session.id,\n    }),\n  };\n};\n```\n\nMaintenant, nous pouvons appeler les fonctions sans serveur depuis notre corps JS avec `fetch("/api/stripe")`. Cela s'adaptera en fonction de la charge et vous ne payez que pour les invocations. Ensuite, cela sera d√©ploy√© √† chaque push vers `main`. Super ! üç¨\n\nPour des raisons de bri√®vet√©, j'ai saut√© le code restant dans les fichiers HTML qui g√®re les rappels de Stripe Checkout. Le code est disponible [ici](https://github.com/aperkaz/serverless-payments).\n\nL'exemple complet est disponible √† l'adresse [https://serverless-payments.netlify.app](https://serverless-payments.netlify.app/). Vous pouvez tester un flux de paiement r√©ussi en utilisant `4242 4242 4242 4242` comme num√©ro de carte de cr√©dit.\n\n![Image](https://paper-attachments.dropbox.com/s_16ACAF73564EBCEEB7494C6A4225B10D5BBA9580C5BBD5452113AF0E1E7CCE6B_1635620255253_Screenshot+2021-10-30+at+20.57.20.png)\n_Stripe Checkout dans toute sa gloire, accessible depuis [notre page](https://serverless-payments.netlify.app" rel="noreferrer nofollow noopener)_\n\n## Conclusion\n\nLes paiements en ligne sont cruciaux pour de nombreuses entreprises en ligne mais sont souvent mis en place √† la h√¢te ou surdimensionn√©s. La solution pr√©sent√©e ci-dessus s'applique aux applications √† page unique, vous n'aurez donc peut-√™tre pas besoin d'un serveur enti√®rement fonctionnel pour g√©rer les paiements pour l'instant. ü§í\n\nJ'esp√®re que cet article vous aidera √† √©clairer la mani√®re d'ajouter facilement le traitement des paiements √† vos pages web existantes. Vendez votre produit rapidement et rendez vos clients heureux !"